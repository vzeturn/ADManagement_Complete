<UserControl x:Class="ADManagement.WPF.Views.UsersView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header and Search -->
        <Border Grid.Row="0" Style="{StaticResource Card}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Title -->
                <TextBlock Grid.Row="0" Text="Active Directory Users" 
                           FontSize="24" FontWeight="Bold" 
                           Foreground="{StaticResource PrimaryBrush}"
                           Margin="0,0,0,16"/>

                <!-- Search and Actions -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Search Box -->
                    <TextBox Grid.Column="0" 
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource ModernTextBox}"
                             Height="36"
                             VerticalAlignment="Center">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding SearchUsersCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>

                    <!-- Search Button -->
                    <Button Grid.Column="1" Content="ðŸ” Search" 
                            Style="{StaticResource PrimaryButton}"
                            Command="{Binding SearchUsersCommand}"
                            Margin="8,0,0,0" Height="36" Width="100"/>

                    <!-- Refresh Button -->
                    <Button Grid.Column="2" Content="ðŸ”„ Refresh" 
                            Style="{StaticResource SecondaryButton}"
                            Command="{Binding RefreshCommand}"
                            Margin="8,0,0,0" Height="36" Width="100"/>
                </Grid>
            </Grid>
        </Border>

        <!-- Users DataGrid -->
        <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,8">
            <Grid>
                <DataGrid x:Name="UsersDataGrid" ItemsSource="{Binding Users}"
                          SelectedItem="{Binding SelectedUser, Mode=TwoWay}"
                          Style="{StaticResource ModernDataGrid}"
                          Visibility="{Binding IsLoading, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                          AutoGenerateColumns="False">
                    <DataGrid.Resources>
                        <Style TargetType="DataGridRow">
                            <EventSetter Event="MouseDoubleClick" Handler="DataGridRow_MouseDoubleClick"/>
                        </Style>
                    </DataGrid.Resources>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Username" Binding="{Binding SamAccountName}" Width="150"/>
                        <DataGridTextColumn Header="Display Name" Binding="{Binding DisplayName}" Width="200"/>
                        <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="250"/>
                        <DataGridTextColumn Header="Department" Binding="{Binding Department}" Width="150"/>
                        <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="150"/>
                        <DataGridTemplateColumn Header="Status" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding AccountStatus}" 
                                               Foreground="{Binding AccountStatus, Converter={StaticResource AccountStatusToColorConverter}}"
                                               FontWeight="Bold"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Loading Indicator -->
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                            Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="â³ Loading users..." FontSize="18" 
                               Foreground="{StaticResource PrimaryBrush}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Action Buttons and Status -->
        <Border Grid.Row="2" Style="{StaticResource Card}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Action Buttons -->
                <WrapPanel Grid.Row="0" Margin="0,0,0,12">
                    <Button Content="âœ“ Enable User" 
                            Style="{StaticResource PrimaryButton}"
                            Command="{Binding EnableUserCommand}"
                            Margin="0,0,8,0" Height="36" Width="130"/>
                    
                    <Button Content="âœ— Disable User" 
                            Style="{StaticResource SecondaryButton}"
                            Command="{Binding DisableUserCommand}"
                            Margin="0,0,8,0" Height="36" Width="130"/>
                    
                    <Button Content="ðŸ”“ Unlock User" 
                            Style="{StaticResource PrimaryButton}"
                            Command="{Binding UnlockUserCommand}"
                            Margin="0,0,8,0" Height="36" Width="130"/>
                    
                    <Button Content="â„¹ï¸ View Details" 
                            Style="{StaticResource SecondaryButton}"
                            Command="{Binding ViewUserDetailsCommand}"
                            Height="36" Width="130"/>
                </WrapPanel>

                <!-- Status Bar -->
                <Border Grid.Row="1" Background="#F0F0F0" Padding="8" CornerRadius="4">
                    <TextBlock Text="{Binding StatusMessage}" FontSize="12"/>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>
