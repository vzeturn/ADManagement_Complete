<Window x:Class="ADManagement.WPF.Views.UserDetailWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="User Properties" Height="650" Width="900"
        WindowStartupLocation="CenterOwner"
        Background="{StaticResource BackgroundBrush}"
        ResizeMode="CanResize">

    <Window.Resources>
        <!-- Tab Header Style -->
        <Style x:Key="TabHeaderStyle" TargetType="TabItem">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="MinWidth" Value="100"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border Name="Border" Background="Transparent" 
                                BorderBrush="#E0E0E0" BorderThickness="1,1,1,0"
                                CornerRadius="4,4,0,0" Margin="2,0,2,0">
                            <ContentPresenter x:Name="ContentSite"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Center"
                                            ContentSource="Header"
                                            Margin="12,8"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="White"/>
                                <Setter TargetName="Border" Property="BorderThickness" Value="1,1,1,0"/>
                                <Setter Property="Panel.ZIndex" Value="100"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="False">
                                <Setter TargetName="Border" Property="Background" Value="#F5F5F5"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#EEEEEE"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Field Label Style -->
        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="MinWidth" Value="140"/>
        </Style>

        <!-- Field Value Style -->
        <Style x:Key="FieldValue" TargetType="TextBox">
            <Setter Property="Padding" Value="8"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Read-only Field Style -->
        <Style x:Key="ReadOnlyField" TargetType="TextBox" BasedOn="{StaticResource FieldValue}">
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="Background" Value="#F9F9F9"/>
        </Style>

        <!-- Section Header Style -->
        <Style x:Key="SectionHeader" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,16,0,8"/>
            <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" Padding="16">
            <StackPanel>
                <TextBlock Text="{Binding DisplayTitle}" FontSize="18" FontWeight="Bold" Foreground="White"/>
                <TextBlock Text="{Binding UserInfo}" FontSize="12" Foreground="White" Opacity="0.9" Margin="0,4,0,0"/>
            </StackPanel>
        </Border>

        <!-- Tab Control -->
        <TabControl Grid.Row="1" Margin="0" BorderThickness="0" Background="White">

            <!-- General Tab -->
            <TabItem Header="General" Style="{StaticResource TabHeaderStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                    <StackPanel>
                        <!-- Basic Information -->
                        <TextBlock Text="Basic Information" Style="{StaticResource SectionHeader}"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="First Name:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding User.FirstName, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Last Name:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding User.LastName, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Display Name:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding User.DisplayName, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Description:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding User.Description, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4" Height="60" 
                                     TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto"/>

                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Office:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding User.Office, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="5" Grid.Column="0" Text="Email:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding User.Email, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="6" Grid.Column="0" Text="Web Page:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="6" Grid.Column="1" Text="{Binding User.WebPage, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Address Tab -->
            <TabItem Header="Address" Style="{StaticResource TabHeaderStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                    <StackPanel>
                        <TextBlock Text="Address Information" Style="{StaticResource SectionHeader}"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Street Address:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding User.StreetAddress, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4" Height="60" 
                                     TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="P.O. Box:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding User.PostOfficeBox, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="City:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding User.City, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="State/Province:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding User.State, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Zip/Postal Code:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding User.PostalCode, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="5" Grid.Column="0" Text="Country/Region:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding User.Country, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Account Tab -->
            <TabItem Header="Account" Style="{StaticResource TabHeaderStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                    <StackPanel>
                        <!-- Account Information -->
                        <TextBlock Text="Account Information" Style="{StaticResource SectionHeader}"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="User Logon Name:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding User.UserPrincipalName}" 
                                     Style="{StaticResource ReadOnlyField}" Margin="0,4"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Logon Name (pre-2000):" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding User.SamAccountName}" 
                                     Style="{StaticResource ReadOnlyField}" Margin="0,4"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Account Status:" Style="{StaticResource FieldLabel}"/>
                            <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Margin="0,4">
                                <TextBlock Text="{Binding AccountStatusText}" VerticalAlignment="Center" 
                                          FontWeight="Bold" Foreground="{Binding AccountStatusColor}"/>
                            </StackPanel>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Last Logon:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding User.LastLogon, StringFormat='yyyy-MM-dd HH:mm:ss'}" 
                                     Style="{StaticResource ReadOnlyField}" Margin="0,4"/>

                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Password Last Set:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding User.PasswordLastSet, StringFormat='yyyy-MM-dd HH:mm:ss'}" 
                                     Style="{StaticResource ReadOnlyField}" Margin="0,4"/>

                            <TextBlock Grid.Row="5" Grid.Column="0" Text="Account Expires:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding User.AccountExpires, StringFormat='yyyy-MM-dd'}" 
                                     Style="{StaticResource ReadOnlyField}" Margin="0,4"/>
                        </Grid>

                        <!-- Account Options -->
                        <TextBlock Text="Account Options" Style="{StaticResource SectionHeader}"/>

                        <StackPanel Margin="0,8">
                            <CheckBox Content="User must change password at next logon" 
                                     IsChecked="{Binding User.MustChangePassword}" Margin="0,4"/>
                            <CheckBox Content="User cannot change password" 
                                     IsChecked="{Binding User.CannotChangePassword}" Margin="0,4"/>
                            <CheckBox Content="Password never expires" 
                                     IsChecked="{Binding User.PasswordNeverExpires}" Margin="0,4"/>
                            <CheckBox Content="Account is disabled" 
                                     IsChecked="{Binding IsAccountDisabled}" Margin="0,4"/>
                        </StackPanel>

                        <!-- Action Buttons -->
                        <StackPanel Orientation="Horizontal" Margin="0,16,0,0">
                            <Button Content="🔓 Unlock Account" Width="140" Height="32" Margin="0,0,8,0"
                                   Command="{Binding UnlockAccountCommand}"
                                   IsEnabled="{Binding User.IsLocked}"
                                   Style="{StaticResource PrimaryButton}"/>
                            <Button Content="🔑 Reset Password" Width="140" Height="32"
                                   Command="{Binding ResetPasswordCommand}"
                                   Style="{StaticResource SecondaryButton}"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Profile Tab -->
            <TabItem Header="Profile" Style="{StaticResource TabHeaderStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                    <StackPanel>
                        <TextBlock Text="Profile Information" Style="{StaticResource SectionHeader}"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Profile Path:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding User.ProfilePath, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Logon Script:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding User.ScriptPath, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Home Folder:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding User.HomeDirectory, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Home Drive:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding User.HomeDrive, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4" MaxLength="2"/>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Telephones Tab -->
            <TabItem Header="Telephones" Style="{StaticResource TabHeaderStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                    <StackPanel>
                        <TextBlock Text="Phone Numbers" Style="{StaticResource SectionHeader}"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Home:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding User.HomePhone, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Pager:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding User.Pager, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Mobile:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding User.Mobile, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Fax:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding User.Fax, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="4" Grid.Column="0" Text="IP Phone:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding User.IpPhone, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="5" Grid.Column="0" Text="Notes:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding User.Info, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4" Height="80" 
                                     TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto"/>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Organization Tab -->
            <TabItem Header="Organization" Style="{StaticResource TabHeaderStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                    <StackPanel>
                        <TextBlock Text="Organization Information" Style="{StaticResource SectionHeader}"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Job Title:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding User.Title, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Department:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding User.Department, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Company:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding User.Company, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Manager:" Style="{StaticResource FieldLabel}"/>
                            <DockPanel Grid.Row="3" Grid.Column="1" Margin="0,4">
                                <Button DockPanel.Dock="Right" Content="🔍" Width="32" Height="32" Margin="4,0,0,0"
                                       ToolTip="Browse for manager"
                                       Command="{Binding BrowseManagerCommand}"/>
                                <TextBox Text="{Binding ManagerDisplayName}" 
                                        Style="{StaticResource ReadOnlyField}"/>
                            </DockPanel>

                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Employee ID:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding User.EmployeeId, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>

                            <TextBlock Grid.Row="5" Grid.Column="0" Text="Employee Type:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding User.EmployeeType, Mode=TwoWay}" 
                                     Style="{StaticResource FieldValue}" Margin="0,4"/>
                        </Grid>

                        <!-- Direct Reports -->
                        <TextBlock Text="Direct Reports" Style="{StaticResource SectionHeader}"/>
                        <ListBox ItemsSource="{Binding User.DirectReports}" Height="120" 
                                Margin="0,8" BorderBrush="#CCCCCC" BorderThickness="1">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" Margin="4"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Member Of Tab -->
            <TabItem Header="Member Of" Style="{StaticResource TabHeaderStyle}">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Search Box -->
                    <Grid Grid.Row="0" Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBox Grid.Column="0" x:Name="GroupSearchBox" 
                                Text="{Binding GroupSearchText, UpdateSourceTrigger=PropertyChanged}"
                                Padding="8" Height="36" VerticalContentAlignment="Center"
                                BorderBrush="#CCCCCC" BorderThickness="1">
                            <TextBox.Style>
                                <Style TargetType="TextBox">
                                    <Style.Triggers>
                                        <Trigger Property="Text" Value="">
                                            <Setter Property="Background">
                                                <Setter.Value>
                                                    <VisualBrush Stretch="None" AlignmentX="Left">
                                                        <VisualBrush.Visual>
                                                            <TextBlock Text="🔍 Search groups..." 
                                                                      Foreground="#999999" 
                                                                      Margin="8,0,0,0"
                                                                      VerticalAlignment="Center"/>
                                                        </VisualBrush.Visual>
                                                    </VisualBrush>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                    </Grid>

                    <!-- Groups List -->
                    <Border Grid.Row="1" BorderBrush="#CCCCCC" BorderThickness="1" Background="White">
                        <ListBox ItemsSource="{Binding FilteredGroups}" 
                                SelectedItem="{Binding SelectedGroup}"
                                BorderThickness="0">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="24"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="👥" FontSize="16" VerticalAlignment="Center"/>
                                        <TextBlock Grid.Column="1" Text="{Binding}" Margin="8,0,0,0" VerticalAlignment="Center"/>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>

                    <!-- Buttons -->
                    <Grid Grid.Row="2" Margin="0,12,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" VerticalAlignment="Center" Foreground="#666666">
                            <Run Text="{Binding FilteredGroups.Count, Mode=OneWay}"/>
                            <Run Text=" group(s)"/>
                        </TextBlock>

                        <Button Grid.Column="1" Content="➕ Add to Group" Width="130" Height="36" 
                               Margin="0,0,8,0"
                               Command="{Binding AddGroupCommand}"
                               Style="{StaticResource PrimaryButton}"/>

                        <Button Grid.Column="2" Content="➖ Remove from Group" Width="160" Height="36"
                               Command="{Binding RemoveGroupCommand}"
                               IsEnabled="{Binding IsGroupSelected}"
                               Style="{StaticResource SecondaryButton}"/>
                    </Grid>
                </Grid>
            </TabItem>

        </TabControl>

        <!-- Footer Buttons -->
        <Border Grid.Row="2" Background="#F5F5F5" Padding="16" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="⚠️" FontSize="16" Margin="0,0,8,0" 
                              Visibility="{Binding HasChanges, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    <TextBlock Text="You have unsaved changes" Foreground="#FF9800"
                              Visibility="{Binding HasChanges, Converter={StaticResource BoolToVisibilityConverter}}"/>
                </StackPanel>

                <Button Grid.Column="1" Content="💾 Apply" Width="100" Height="36" 
                       Margin="0,0,8,0"
                       Command="{Binding ApplyCommand}"
                       IsEnabled="{Binding HasChanges}"
                       Style="{StaticResource PrimaryButton}"/>

                <Button Grid.Column="2" Content="✓ OK" Width="100" Height="36"
                       Command="{Binding OkCommand}"
                       Style="{StaticResource PrimaryButton}"/>
            </Grid>
        </Border>

        <!-- Loading Overlay -->
        <Border Grid.RowSpan="3" Background="#80000000" 
               Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <Border Background="White" Padding="32" CornerRadius="8"
                   HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="⏳ Loading..." FontSize="16" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding LoadingMessage}" FontSize="12" 
                              Foreground="#666666" Margin="0,8,0,0" HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</Window>
